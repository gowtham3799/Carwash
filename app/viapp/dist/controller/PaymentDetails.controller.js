sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ui/core/UIComponent"],function(e,t,a,o){"use strict";return e.extend("viapp.controller.PaymentDetails",{onInit:function(){this._oRouter=sap.ui.core.UIComponent.getRouterFor(this);this._oRouter.attachRouteMatched(this.handleRouteMatched,this)},handleRouteMatched:function(e){},onPressNavtoPaymentapp:function(){sap.m.MessageToast.show("Navigating to payment app");var e="39921047";var t="100";var a={Saleorder:"",Invoice:"",MOPType:"",CardNo:"",Authcode:"",TransactionMessage:""};var o=JSON.stringify(a);let r="com.sap.mobile.start://navigation?resolve-type=ibn#viapp-display?sap-ui-app-id-hint=saas_approuter_viapp";let i=encodeURIComponent(r);var s={trxnType:"SALE",amount:t,mode:"card",trxnID:e};var n=JSON.stringify(s);var p=encodeURIComponent(n);console.log(i);var l="adnoc://sapmetapay.com/card?data="+p+"&returnUrl="+i;window.location.href=l},ongetSOdetails:function(){var e=this.getView().getModel("oGlobalModel").getProperty("/Saleorder");var o=this.getView().getModel("oGlobalModel").getProperty("/Authcode");this.getView().getModel("CarwashService").read("/Payment",{filters:[new t("ORDERNUM",a.EQ,e)],urlParameters:{$expand:"ITEMS"},success:function(e,t){var a="";var r=e.results[0].ITEMS.results;for(var i=0;i<r.length;i++){if(r[i].MOP_TYPE==="CARD"){r[i].AUTH_CODE=o;a=r[i]}}if(a){this.saveDetails(a)}}.bind(this),error:function(e){MessageBox.error(e.message)}.bind(this)})},saveDetails:function(e){var t={ID:e.ID,PARENT_KEY_ID:e.PARENT_KEY_ID,MOP_COUNTER:e.MOP_COUNTER,AMOUNT:e.AMOUNT,CURRENCY:e.CURRENCY,MOP_TYPE:e.MOP_TYPE,AUTH_CODE:e.AUTH_CODE};var a=this.getView().getModel("CarwashService");var o="";o=a.createKey("/PaymentItem",{ID:e.ID});a.sDefaultUpdateMethod=sap.ui.model.odata.UpdateMethod.Put;a.update(o,t,{success:function(e,t){if(e.ID){sap.m.MessageToast.show("Payment Details Updated successfully");this.onRemoveKeyParameter()}}.bind(this),error:function(e){MessageBox.error(e.message)}.bind(this)})},removeKeyParameter:function(){var e="com.sap.mobile.start://navigation?resolve-type=ibn#viapp-display?sap-ui-app-id-hint=saas_approuter_viapp";window.history.replaceState({},document.title,e);alert("Back to Home from Payment");var t=o.getRouterFor(this);t.navTo("Home",{},true)},onRemoveKeyParameter:function(){var e=o.getRouterFor(this);e.navTo("home",true)}})});
//# sourceMappingURL=PaymentDetails.controller.js.map